# Inngest Quick Start Guide

Get the Inngest job queue system running in 5 minutes.

## Prerequisites

- Node.js 18+ installed
- Supabase project set up
- Environment variables configured

## Step 1: Install Dependencies (Already Done)

```bash
npm install
```

Inngest is already installed in `package.json`.

## Step 2: Run Database Migration

Apply the message templates migration:

```bash
# If using Supabase CLI
supabase db push supabase/migrations/20250930_add_inngest_templates.sql

# Or copy/paste SQL from the migration file into Supabase SQL Editor
```

This adds 8 new message templates (reminder-1h, thank-you, resources, etc.).

## Step 3: Set Environment Variables

Add to `.env.local`:

```bash
# Inngest (for local dev, these are auto-generated by dev server)
INNGEST_EVENT_KEY=test
INNGEST_SIGNING_KEY=test
```

For local development, the Inngest Dev Server will handle these automatically.

## Step 4: Start Inngest Dev Server

In one terminal:

```bash
npm run inngest:dev
```

This starts the Inngest Dev Server at http://localhost:8288

## Step 5: Start Next.js Dev Server

In another terminal:

```bash
npm run dev
```

Your app is now at http://localhost:3000

## Step 6: Test the Integration

### Option A: Via Enrollment API

```bash
# First, get a test event ID from your database
curl -X POST http://localhost:3000/api/enrollments \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@ceremonia.com",
    "firstName": "Test",
    "lastName": "User",
    "eventId": "YOUR_EVENT_ID_HERE"
  }'
```

### Option B: Via Test Script (Easier)

```bash
# Test pre-event funnel (creates test data if needed)
npm run inngest:test:pre

# Test post-event funnel
npm run inngest:test:post

# Test all functions
npm run inngest:test:all
```

## Step 7: View Jobs in Dashboard

Open http://localhost:8288 to see:
- Running functions
- Function logs
- Event payloads
- Retry attempts

## What You'll See

### Console Output

The message sender will log placeholder messages like:

```
=== MESSAGE SEND (PLACEHOLDER) ===
Message ID: abc-123
Channel: email
Template: welcome-email
Contact: Test User (test@ceremonia.com)
Recipient: test@ceremonia.com
Event: How to Build AI-Powered Funnels
Scheduled: 2025-10-07T10:00:00Z
Join URL: https://zoom.us/j/123456789
=================================
```

### Inngest Dashboard

You'll see function execution with:
- Step-by-step progress
- Sleep timers for delays
- Success/failure status
- Retry attempts

### Database Records

Check `sent_messages` table for records:

```sql
SELECT * FROM sent_messages ORDER BY created_at DESC LIMIT 10;
```

## Troubleshooting

### Error: "Inngest client not initialized"

Make sure the Inngest Dev Server is running (`npm run inngest:dev`).

### Error: "Template not found"

Run the database migration to add missing templates.

### Jobs not showing in dashboard

1. Check that Next.js is running on port 3000
2. Check that Inngest Dev Server is running on port 8288
3. Verify `/api/inngest` endpoint is accessible

### TypeScript errors

```bash
# Rebuild types
npm run build
```

## Next Steps

1. Test with real event data
2. Integrate Resend for actual email sending
3. Integrate Twilio for SMS sending
4. Set up Zoom webhooks for attendance tracking
5. Deploy to production with Inngest Cloud

## Useful Commands

```bash
# Start Inngest Dev Server
npm run inngest:dev

# Test pre-event funnel
npm run inngest:test:pre

# Test post-event funnel
npm run inngest:test:post

# Test all functions
npm run inngest:test:all

# View Inngest logs
# (available in dashboard at http://localhost:8288)
```

## Support

- **Documentation**: `/docs/inngest-implementation.md`
- **Inngest Docs**: https://www.inngest.com/docs
- **Inngest Discord**: https://www.inngest.com/discord

---

That's it! You now have a fully functional job queue system. Messages are currently logged to console - the next step is integrating Resend and Twilio for actual delivery.
